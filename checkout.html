<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <base href="/commercemobile/">
  <title>Quantum Commerce — Checkout</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="preload" href="css/app.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="css/app.min.css"></noscript>
</head>
<body>
  <nav class="nav">
    <div class="brand">
      <div class="brand-logo" aria-hidden="true">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="9" stroke="#00e5ff" stroke-width="1.5" opacity="0.8"/>
          <path d="M7 12c0-2.8 2.2-5 5-5" stroke="#1de9b6" stroke-width="1.5"/>
          <circle cx="17" cy="12" r="1.3" fill="#00e5ff"/>
        </svg>
      </div>
      <div>
        <div class="brand-title">Quantum Commerce</div>
        <small class="auth-greeting">Welcome, Guest</small>
      </div>
    </div>
    <button id="nav-toggle" class="hamburger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="products.html">Products</a>
      <a href="auth/login.html">Login</a>
      <a href="auth/register.html">Register</a>
      <a class="cart-cta" href="cart.html" aria-label="Cart">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6h14l-2 9H8L6 6z" stroke="#00e5ff" stroke-width="1.5"/>
          <circle cx="10" cy="20" r="1.5" fill="#00e5ff"/>
          <circle cx="17" cy="20" r="1.5" fill="#1de9b6"/>
        </svg>
        <span>Cart</span>
        <span class="cart-count">0</span>
      </a>
    </div>
  </nav>

  <main class="container">
    <section class="hero">
      <h1>Checkout</h1>
      <p class="sub">Secure your order with a few details.</p>
    </section>

    <div class="grid" style="grid-template-columns: 1fr; gap:20px">
      <form id="checkout-form" class="panel">
        <h2>Shipping</h2>
        <div class="grid" style="grid-template-columns: 1fr; gap:12px">
          <div><small>Name</small><input class="input" required name="name"/></div>
          <div><small>Phone</small><input class="input" required name="phone"/></div>
          <div><small>Address</small><input class="input" required name="address"/></div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px">
            <div><small>City</small><input class="input" required name="city"/></div>
            <div><small>Postal Code</small><input class="input" required name="zip"/></div>
          </div>
        </div>
        <h2 style="margin-top:16px">Payment</h2>
        <div class="grid" style="grid-template-columns: 1fr; gap:12px">
          <div><small>Card Number</small><input class="input" required name="card" inputmode="numeric" maxlength="19" placeholder="xxxx xxxx xxxx xxxx"/></div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px">
            <div><small>Expiry</small><input class="input" required name="exp" placeholder="MM/YY"/></div>
            <div><small>CVV</small><input class="input" required name="cvv" inputmode="numeric" maxlength="4"/></div>
          </div>
        </div>
        <button class="button" type="submit" style="margin-top:14px">Place Order</button>
      </form>

      <div class="panel">
        <h2>Order Summary</h2>
        <div id="summary"></div>
        <hr/>
        <div style="display:flex; justify-content:space-between">
          <span>Total</span>
          <strong id="grand" class="price">₹0</strong>
        </div>
      </div>
    </div>
  </main>

  <div class="spacer"></div>

  <script src="js/auth.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/particles.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      Auth.requireAuth('auth/login.html');
      const list = Cart.read();
      const summary = document.getElementById('summary');
      const grand = document.getElementById('grand');
      summary.innerHTML = list.map(i => `
        <div style="display:flex; justify-content:space-between; margin:6px 0">
          <span>${i.title} × ${i.qty}</span>
          <span>₹${(i.price*i.qty).toLocaleString()}</span>
        </div>
      `).join('') || '<small>Your cart is empty.</small>';
      grand.textContent = '₹' + Cart.total().toLocaleString();

      document.getElementById('checkout-form').addEventListener('submit', e => {
        e.preventDefault();
        if(!list.length){ alert('Your cart is empty.'); return; }
        const fd = new FormData(e.target);
        for(const key of ['name','phone','address','city','zip','card','exp','cvv']){
          if(!(fd.get(key)||'').toString().trim()){ alert('Please complete the form.'); return; }
        }
        const orderId = 'QC-' + Math.random().toString(36).slice(2,8).toUpperCase();
        Cart.clear();
        alert('Order placed! ID: ' + orderId);
        window.location.href = 'index.html';
      });
    });
  </script>
</body>

</html>
